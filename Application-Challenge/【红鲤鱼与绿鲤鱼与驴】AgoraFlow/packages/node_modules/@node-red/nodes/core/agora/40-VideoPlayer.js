
module.exports = function(RED) {
    function AgoraVideoPlayerNode(config) {
        RED.nodes.createNode(this,config);
        var node = this;

        node.on("input", function(msg, send, done){
            gMsg = getGlobalMsg(msg);
            if (gMsg.payload.downstreamOptions){
                if (!gMsg.payload.downstreamFilter){
                    gMsg.payload.downstreamFilter = []
                }else{
                    const theFilter = gMsg.payload.downstreamFilter.find((item)=>{
                        return !item.player;
                    });
                    console.log("theFilter", theFilter)
                    if (theFilter){
                        theFilter.player = config.playOptions;
                    }else{
                        gMsg.payload.downstreamFilter.push({player: config.playOptions})
                    }
                }
            }else{
                gMsg.payload.videoPlayer = config.playOptions;
            }
        });
    }
    RED.nodes.registerType("agora-video-player", AgoraVideoPlayerNode);
}